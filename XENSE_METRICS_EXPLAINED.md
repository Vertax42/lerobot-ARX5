# Xense æ€§èƒ½æŒ‡æ ‡è¯¦è§£

## ğŸ“Š æŒ‡æ ‡è®¡ç®—æ–¹æ³•

### 1. **Latency (å»¶è¿Ÿ)** - å•æ¬¡è¯»å–è€—æ—¶

#### è®¡ç®—æ–¹æ³•
```python
read_start = time.perf_counter()  # å¼€å§‹è®¡æ—¶ (é«˜ç²¾åº¦)
data = camera.read()               # æ‰§è¡Œè¯»å–æ“ä½œ
read_end = time.perf_counter()     # ç»“æŸè®¡æ—¶

latency_ms = (read_end - read_start) * 1000  # è½¬æ¢ä¸ºæ¯«ç§’
```

#### å«ä¹‰
- **æµ‹é‡çš„æ˜¯**ï¼šä»è°ƒç”¨ `camera.read()` åˆ°æ•°æ®è¿”å›çš„æ—¶é—´
- **å•ä½**ï¼šæ¯«ç§’ (ms)
- **åŒ…å«**ï¼š
  - SDK å†…éƒ¨å¤„ç†æ—¶é—´
  - GPU/CPU æ¨ç†æ—¶é—´ï¼ˆå¦‚æœéœ€è¦ï¼‰
  - æ•°æ®ä¼ è¾“æ—¶é—´
  - Python å‡½æ•°è°ƒç”¨å¼€é”€

#### ç¤ºä¾‹
```
Frame 1: latency = 10.18ms  â† è¿™ä¸€å¸§è¯»å–è€—æ—¶ 10.18ms
Frame 2: latency = 10.11ms  â† è¿™ä¸€å¸§è¯»å–è€—æ—¶ 10.11ms
Frame 3: latency = 10.09ms  â† è¿™ä¸€å¸§è¯»å–è€—æ—¶ 10.09ms
```

#### ç»Ÿè®¡æŒ‡æ ‡
- **Mean (å¹³å‡å€¼)**: æ‰€æœ‰å¸§å»¶è¿Ÿçš„å¹³å‡å€¼
- **Median (ä¸­ä½æ•°)**: æ’åºåä¸­é—´ä½ç½®çš„å€¼
- **P95**: 95% çš„å¸§å»¶è¿Ÿéƒ½å°äºæ­¤å€¼
- **P99**: 99% çš„å¸§å»¶è¿Ÿéƒ½å°äºæ­¤å€¼
- **Std Dev (æ ‡å‡†å·®)**: å»¶è¿Ÿæ³¢åŠ¨ç¨‹åº¦

---

### 2. **FPS (Frames Per Second)** - æ¯ç§’å¸§æ•°

#### è®¡ç®—æ–¹æ³•
```python
start_time = time.time()          # æµ‹è¯•å¼€å§‹æ—¶é—´
frame_count = 0                   # å¸§è®¡æ•°å™¨

while time.time() - start_time < 30:  # è¿è¡Œ 30 ç§’
    data = camera.read()
    frame_count += 1              # æ¯è¯»ä¸€å¸§ +1

total_elapsed = time.time() - start_time
fps = frame_count / total_elapsed    # æ€»å¸§æ•° Ã· æ€»æ—¶é—´
```

#### å«ä¹‰
- **æµ‹é‡çš„æ˜¯**ï¼šå•ä½æ—¶é—´å†…èƒ½è¯»å–å¤šå°‘å¸§
- **å•ä½**ï¼šå¸§/ç§’ (frames/second)
- **åæ˜ **ï¼šç³»ç»Ÿçš„ååé‡

#### ç¤ºä¾‹
```
30 ç§’å†…è¯»å–äº† 2947 å¸§
FPS = 2947 / 30 = 98.23 fps

æ„æ€æ˜¯ï¼šå¹³å‡æ¯ç§’è¯»å– 98.23 å¸§
```

---

## ğŸ” æ·±å…¥ç†è§£ï¼šLatency vs FPS

### å®ƒä»¬çš„å…³ç³»

```
ç†è®ºä¸Š: FPS = 1000 / latency_ms

ä½†å®é™…ä¸Šï¼š
å®é™… FPS â‰  1000 / latency_ms
```

### ä¸ºä»€ä¹ˆä¸ç›¸ç­‰ï¼Ÿ

è®©æˆ‘ä»¬ç”¨ä½ çš„æµ‹è¯•æ•°æ®æ¥è§£é‡Šï¼š

```python
# ä½ çš„æµ‹è¯•ç»“æœ
Average latency: 10.18ms
Average FPS: 98.23

# ç†è®ºè®¡ç®—
ç†è®º FPS = 1000 / 10.18 = 98.23 fps  âœ… åŸºæœ¬å»åˆï¼
```

ä½†è¿™æ˜¯**å·§åˆ**ï¼Œå› ä¸ºä½ çš„æµ‹è¯•ä»£ç ä¸­æœ‰ï¼š

```python
while time.time() - start_time < duration_seconds:
    read_start = time.perf_counter()
    _ = camera.read()  # â† è€—æ—¶ ~10ms
    read_end = time.perf_counter()
    # â† è¿™é‡Œç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œæ²¡æœ‰é¢å¤–å»¶è¿Ÿ
```

### å®é™…åœºæ™¯å¯¹æ¯”

#### åœºæ™¯ 1ï¼šè¿ç»­æœ€å¿«è¯»å–ï¼ˆä½ çš„æµ‹è¯•ï¼‰
```python
for i in range(100):
    data = camera.read()  # 10ms
    # ç«‹å³ä¸‹ä¸€æ¬¡è¯»å–

æ—¶é—´è½´ï¼š
|--read(10ms)--|--read(10ms)--|--read(10ms)--|
0ms           10ms          20ms          30ms

ç»“æœï¼š
- Latency: 10ms
- FPS = 1000/10 = 100 fps âœ…
```

#### åœºæ™¯ 2ï¼šæœ‰å¤„ç†å»¶è¿Ÿ
```python
for i in range(100):
    data = camera.read()        # 10ms
    process_data(data)          # 5ms
    # ç„¶åä¸‹ä¸€æ¬¡è¯»å–

æ—¶é—´è½´ï¼š
|--read(10ms)--|process(5ms)|--read(10ms)--|process(5ms)|
0ms           10ms         15ms          25ms         30ms

ç»“æœï¼š
- Latency: 10ms (åªè®¡ç®— read æ—¶é—´)
- FPS = 1000/15 = 66.7 fps âŒ ä¸ç­‰äº 1000/10
```

#### åœºæ™¯ 3ï¼šå›ºå®šé¢‘ç‡é‡‡æ ·
```python
for i in range(100):
    data = camera.read()        # 10ms
    sleep(40ms)                 # å›ºå®šé—´éš”
    # ç„¶åä¸‹ä¸€æ¬¡è¯»å–

æ—¶é—´è½´ï¼š
|--read(10ms)--|--sleep(40ms)--|--read(10ms)--|--sleep(40ms)--|
0ms           10ms            50ms          60ms           100ms

ç»“æœï¼š
- Latency: 10ms
- FPS = 1000/50 = 20 fps âŒ è¿œå°äº 1000/10
```

---

## ğŸ“ˆ ä½ çš„æµ‹è¯•ç»“æœåˆ†æ

### åŒæ­¥è¯»å–æµ‹è¯•
```
Total frames:      2947
Total time:        30.00s
Average FPS:       98.23
Mean latency:      10.18ms
```

#### è®¡ç®—éªŒè¯
```python
# FPS è®¡ç®—
FPS = 2947 / 30.00 = 98.23 fps âœ…

# æ¯å¸§é—´éš”
interval = 30.00 / 2947 = 10.18ms âœ…

# å…³ç³»éªŒè¯
1000 / 10.18 = 98.23 fps âœ…
```

#### æ—¶é—´è½´å¯è§†åŒ–
```
æµ‹è¯•å¾ªç¯æ‰§è¡Œï¼š
Frame 1: |--read(10.18ms)--|
Frame 2:                    |--read(10.18ms)--|
Frame 3:                                      |--read(10.18ms)--|
...
Frame 2947:                                                      |--read(10.18ms)--|
         0ms              10.18ms           20.36ms            30000ms
```

**å…³é”®ç‚¹**ï¼š
- æ¯æ¬¡ `read()` è€—æ—¶ 10.18ms (latency)
- ç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡ `read()`ï¼Œæ²¡æœ‰å…¶ä»–å»¶è¿Ÿ
- æ‰€ä»¥ FPS = 1000 / latency

---

## ğŸ¯ å®é™…åº”ç”¨ä¸­çš„æ„ä¹‰

### å¯¹äºæœºå™¨äººæ§åˆ¶å¾ªç¯

```python
# ä½ çš„æœºå™¨äººæ§åˆ¶å¾ªç¯ (100Hz = 10mså‘¨æœŸ)
control_dt = 0.01  # 10ms

while True:
    loop_start = time.time()
    
    # 1. è¯»å–ä¼ æ„Ÿå™¨
    tactile = tactile_camera.async_read()  # latency: <1ms (å¼‚æ­¥)
    joint_state = robot.get_state()        # latency: ~2ms
    
    # 2. ç­–ç•¥æ¨ç†
    action = policy(tactile, joint_state)  # latency: ~3ms
    
    # 3. å‘é€æŒ‡ä»¤
    robot.send_action(action)              # latency: ~1ms
    
    # 4. ç­‰å¾…åˆ° 10ms
    elapsed = time.time() - loop_start
    sleep(control_dt - elapsed)
    
    # å®é™… FPS = 1000 / 10 = 100 fps
    # ä½†ä¼ æ„Ÿå™¨ latency åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†
```

### é‡è¦åŒºåˆ«

| æŒ‡æ ‡ | æµ‹é‡å¯¹è±¡ | å®é™…æ„ä¹‰ |
|------|---------|---------|
| **Latency** | å•ä¸ªæ“ä½œè€—æ—¶ | å“åº”é€Ÿåº¦ |
| **FPS** | æ•´ä½“ååé‡ | å¤„ç†èƒ½åŠ› |

#### ä½ çš„ Xense ä¼ æ„Ÿå™¨
- **Latency 10ms** â†’ ä»è¯·æ±‚åˆ°è·å–æ•°æ®éœ€è¦ 10ms
- **FPS 98** â†’ æ¯ç§’å¯ä»¥è¯»å– 98 æ¬¡

**å¦‚æœç”¨å¼‚æ­¥è¯»å–**ï¼š
- **Async latency <1ms** â†’ ä¸»çº¿ç¨‹å‡ ä¹ä¸ç­‰å¾…
- **Backend FPS 98** â†’ åå°çº¿ç¨‹ä¿æŒ 98 fps æ›´æ–°

---

## ğŸ”¬ è¿›é˜¶ï¼šä¸ºä»€ä¹ˆ latency â‰ˆ FPS é—´éš”ï¼Ÿ

### åŸå› åˆ†æ

ä½ çš„æµ‹è¯•ä»£ç ï¼š
```python
while time.time() - start_time < 30:
    read_start = time.perf_counter()
    _ = camera.read()              # â† A. è¯»å–æ•°æ®
    read_end = time.perf_counter()
    
    latency = read_end - read_start  # â† B. è®¡ç®—å»¶è¿Ÿ
    latencies.append(latency)        # â† C. è®°å½•
    frame_count += 1                 # â† D. è®¡æ•°
    # â† E. ç«‹å³å›åˆ°å¾ªç¯å¼€å§‹
```

**å…³é”®**ï¼šæ­¥éª¤ Bã€Cã€Dã€E çš„è€—æ—¶å¯ä»¥å¿½ç•¥ä¸è®¡ï¼ˆ<0.1msï¼‰

æ‰€ä»¥ï¼š
```
å¾ªç¯å‘¨æœŸ â‰ˆ read() è€—æ—¶ â‰ˆ latency
FPS = 1000 / å¾ªç¯å‘¨æœŸ â‰ˆ 1000 / latency
```

### å¦‚æœæœ‰é¢å¤–å¤„ç†

å‡è®¾ä½ æ·»åŠ äº†æ•°æ®å¤„ç†ï¼š
```python
while time.time() - start_time < 30:
    read_start = time.perf_counter()
    data = camera.read()              # 10ms
    read_end = time.perf_counter()
    
    # é¢å¤–å¤„ç†
    process(data)                     # 5ms
    save_to_disk(data)                # 3ms
    
    latency = read_end - read_start   # ä»ç„¶åªè®¡ç®— read() = 10ms
    frame_count += 1
```

ç»“æœï¼š
- **Latency**: 10ms (åªè®¡ç®— read)
- **FPS**: 1000 / (10+5+3) = 55.6 fps

---

## ğŸ“ æ€»ç»“

### Latency (å»¶è¿Ÿ)
- **å®šä¹‰**: å•æ¬¡ `read()` æ“ä½œçš„è€—æ—¶
- **è®¡ç®—**: `(read_end - read_start) * 1000`
- **ä½ çš„ç»“æœ**: 10.18ms
- **å«ä¹‰**: ä»è°ƒç”¨åˆ°è¿”å›éœ€è¦ 10.18ms

### FPS (å¸§ç‡)
- **å®šä¹‰**: æ¯ç§’å®Œæˆçš„è¯»å–æ¬¡æ•°
- **è®¡ç®—**: `æ€»å¸§æ•° / æ€»æ—¶é—´`
- **ä½ çš„ç»“æœ**: 98.23 fps
- **å«ä¹‰**: æ¯ç§’è¯»å– 98.23 å¸§

### å…³ç³»
```python
åœ¨ä½ çš„æµ‹è¯•ä¸­:
FPS â‰ˆ 1000 / latency

å› ä¸º: å¾ªç¯ä¸­åªæœ‰ read() æ“ä½œï¼Œæ²¡æœ‰å…¶ä»–å»¶è¿Ÿ

åœ¨å®é™…åº”ç”¨ä¸­:
FPS = 1000 / (latency + å…¶ä»–å¤„ç†æ—¶é—´)
```

### å®é™…å»ºè®®
1. **å…³æ³¨ latency** - å¦‚æœéœ€è¦å¿«é€Ÿå“åº”
2. **å…³æ³¨ FPS** - å¦‚æœéœ€è¦é«˜ååé‡
3. **ä½¿ç”¨å¼‚æ­¥è¯»å–** - å‡å°‘ latency å¯¹ä¸»å¾ªç¯çš„å½±å“

å¸Œæœ›è¿™ä¸ªè§£é‡Šæ¸…æ¥šäº†ï¼ğŸ“

